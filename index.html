<!DOCTYPE html>
<html lang="en" manifest="data:text/cache-manifest;base64,Q0FDSEUgTUFOSUZFU1QKIyBWZXJzaW9uIDEuMAoKQ0FDSEU6CmluZGV4Lmh0bWwKCk5FVFdPUks6Cio=">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Bubble Shooter">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiB2aWV3Qm94PSIwIDAgMTgwIDE4MCI+CiAgPHJlY3Qgd2lkdGg9IjE4MCIgaGVpZ2h0PSIxODAiIGZpbGw9IiM2NjdlZWEiLz4KICA8Y2lyY2xlIGN4PSI5MCIgY3k9IjkwIiByPSI2MCIgZmlsbD0iI2ZmNmI2YiIgc3Ryb2tlPSIjZmZmIiBzdHJva2Utd2lkdGg9IjQiLz4KICA8Y2lyY2xlIGN4PSI3NSIgY3k9Ijc1IiByPSIxMCIgZmlsbD0iI2ZmZiIgb3BhY2l0eT0iMC43Ii8+Cjwvc3ZnPg==">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQnViYmxlIFNob290ZXIiLCJzaG9ydF9uYW1lIjoiQnViYmxlcyIsInN0YXJ0X3VybCI6Ii4vIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzY2N2VlYSIsInRoZW1lX2NvbG9yIjoiIzY2N2VlYSIsIm9yaWVudGF0aW9uIjoiYW55In0=">
    <title>Bubble Shooter - Kids Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: Arial, sans-serif;
            background: #667eea;
            background: -webkit-linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            position: fixed;
            width: 100%;
        }

        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: -webkit-flex;
            display: flex;
            -webkit-flex-direction: column;
            flex-direction: column;
        }

        #gameHeader {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            text-align: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        #gameCanvas {
            -webkit-flex: 1;
            flex: 1;
            background: #87CEEB;
            background: -webkit-linear-gradient(to bottom, #87CEEB 0%, #98FB98 100%);
            background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 100%);
            display: block;
            cursor: pointer;
            width: 100%;
        }

        #gameUI {
            position: absolute;
            top: 60px;
            left: 10px;
            color: white;
            font-size: 18px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            z-index: 10;
        }

        #shooter {
            position: absolute;
            bottom: 20px;
            left: 50%;
            -webkit-transform: translateX(-50%);
            transform: translateX(-50%);
            width: 60px;
            height: 60px;
            background: #ff6b6b;
            background: -webkit-radial-gradient(circle, #ff6b6b, #ee5a24);
            background: radial-gradient(circle, #ff6b6b, #ee5a24);
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            z-index: 5;
        }

        #gameOver {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.8);
            display: none;
            -webkit-justify-content: center;
            justify-content: center;
            -webkit-align-items: center;
            align-items: center;
            z-index: 100;
        }

        #gameOverContent {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        button {
            background: #ff6b6b;
            background: -webkit-linear-gradient(45deg, #ff6b6b, #4ecdc4);
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 25px;
            cursor: pointer;
            font-family: inherit;
            margin: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            -webkit-appearance: none;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="gameHeader">
            Bubble Shooter
        </div>
        
        <div id="gameUI">
            <div>Score: <span id="score">0</span></div>
            <div>Level: <span id="level">1</span></div>
        </div>

        <canvas id="gameCanvas"></canvas>
        
        <div id="shooter"></div>
    </div>

    <div id="gameOver">
        <div id="gameOverContent">
            <h2>Great Job!</h2>
            <p>Final Score: <span id="finalScore">0</span></p>
            <button onclick="restartGame()">Play Again</button>
        </div>
    </div>

    <script>
        // Compatibility fixes for older browsers
        if (!window.requestAnimationFrame) {
            window.requestAnimationFrame = window.webkitRequestAnimationFrame || 
                                          window.mozRequestAnimationFrame || 
                                          function(callback) { return setTimeout(callback, 1000/60); };
        }

        var canvas = document.getElementById('gameCanvas');
        var ctx = canvas.getContext('2d');
        var scoreElement = document.getElementById('score');
        var levelElement = document.getElementById('level');
        var gameOverElement = document.getElementById('gameOver');
        var finalScoreElement = document.getElementById('finalScore');

        // Game state - using var for compatibility
        var score = 0;
        var level = 1;
        var bubbles = [];
        var targets = [];
        var particles = [];
        var gameRunning = true;

        // Colors for bubbles and targets
        var colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#fab1a0', '#fd79a8', '#a29bfe'];

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight - 60;
        }

        function getRandomColor() {
            return colors[Math.floor(Math.random() * colors.length)];
        }

        function createTarget() {
            var target = {
                x: Math.random() * (canvas.width - 60) + 30,
                y: Math.random() * (canvas.height * 0.6) + 50,
                radius: 25 + Math.random() * 15,
                color: getRandomColor(),
                vx: (Math.random() - 0.5) * 2,
                vy: (Math.random() - 0.5) * 2
            };
            targets.push(target);
        }

        function createBubble(x, y, targetX, targetY) {
            var bubble = {
                x: x,
                y: y,
                radius: 15,
                color: getRandomColor(),
                vx: (targetX - x) * 0.01,
                vy: (targetY - y) * 0.01,
                speed: 8
            };
            
            var distance = Math.sqrt(bubble.vx * bubble.vx + bubble.vy * bubble.vy);
            bubble.vx = (bubble.vx / distance) * bubble.speed;
            bubble.vy = (bubble.vy / distance) * bubble.speed;
            
            bubbles.push(bubble);
        }

        function createParticle(x, y, color) {
            for (var i = 0; i < 8; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 8,
                    vy: (Math.random() - 0.5) * 8,
                    color: color,
                    life: 30,
                    maxLife: 30
                });
            }
        }

        function drawCircle(x, y, radius, color) {
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.fillStyle = color;
            ctx.fill();
            ctx.strokeStyle = 'rgba(255,255,255,0.6)';
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        function updateGame() {
            if (!gameRunning) return;

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Update and draw bubbles
            for (var i = bubbles.length - 1; i >= 0; i--) {
                var bubble = bubbles[i];
                bubble.x += bubble.vx;
                bubble.y += bubble.vy;

                drawCircle(bubble.x, bubble.y, bubble.radius, bubble.color);

                // Remove bubbles that go off screen
                if (bubble.x < 0 || bubble.x > canvas.width || bubble.y < 0 || bubble.y > canvas.height) {
                    bubbles.splice(i, 1);
                    continue;
                }

                // Check collision with targets
                for (var j = targets.length - 1; j >= 0; j--) {
                    var target = targets[j];
                    var dx = bubble.x - target.x;
                    var dy = bubble.y - target.y;
                    var distance = Math.sqrt(dx * dx + dy * dy);

                    if (distance < bubble.radius + target.radius) {
                        // Hit!
                        createParticle(target.x, target.y, target.color);
                        score += 10;
                        scoreElement.textContent = score;
                        
                        bubbles.splice(i, 1);
                        targets.splice(j, 1);
                        break;
                    }
                }
            }

            // Update and draw targets
            for (var k = 0; k < targets.length; k++) {
                var target = targets[k];
                target.x += target.vx;
                target.y += target.vy;

                // Bounce off walls
                if (target.x <= target.radius || target.x >= canvas.width - target.radius) {
                    target.vx = -target.vx;
                }
                if (target.y <= target.radius || target.y >= canvas.height * 0.7) {
                    target.vy = -target.vy;
                }

                drawCircle(target.x, target.y, target.radius, target.color);
            }

            // Update and draw particles
            for (var p = particles.length - 1; p >= 0; p--) {
                var particle = particles[p];
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.life--;

                var alpha = particle.life / particle.maxLife;
                ctx.globalAlpha = alpha;
                ctx.fillStyle = particle.color;
                ctx.fillRect(particle.x, particle.y, 4, 4);
                ctx.globalAlpha = 1;

                if (particle.life <= 0) {
                    particles.splice(p, 1);
                }
            }

            // Check if level complete
            if (targets.length === 0) {
                level++;
                levelElement.textContent = level;
                
                // Create more targets for next level
                var targetCount = Math.min(3 + level, 10);
                for (var t = 0; t < targetCount; t++) {
                    (function(index) {
                        setTimeout(function() { createTarget(); }, index * 200);
                    })(t);
                }
            }

            // End game if score reaches 500
            if (score >= 500) {
                endGame();
            }

            // Continue game loop
            requestAnimationFrame(updateGame);
        }

        function endGame() {
            gameRunning = false;
            finalScoreElement.textContent = score;
            gameOverElement.style.display = 'flex';
            gameOverElement.style.display = '-webkit-flex';
        }

        function restartGame() {
            score = 0;
            level = 1;
            bubbles = [];
            targets = [];
            particles = [];
            gameRunning = true;
            
            scoreElement.textContent = score;
            levelElement.textContent = level;
            gameOverElement.style.display = 'none';
            
            // Create initial targets
            for (var i = 0; i < 3; i++) {
                createTarget();
            }
            
            updateGame();
        }

        // Handle clicks and touches
        function handleInteraction(e) {
            if (!gameRunning) return;
            
            e.preventDefault();
            
            var rect = canvas.getBoundingClientRect();
            var x, y;
            
            if (e.touches && e.touches.length > 0) {
                x = e.touches[0].clientX - rect.left;
                y = e.touches[0].clientY - rect.top;
            } else if (e.changedTouches && e.changedTouches.length > 0) {
                x = e.changedTouches[0].clientX - rect.left;
                y = e.changedTouches[0].clientY - rect.top;
            } else {
                x = e.clientX - rect.left;
                y = e.clientY - rect.top;
            }
            
            var shooterX = canvas.width / 2;
            var shooterY = canvas.height - 40;
            
            createBubble(shooterX, shooterY, x, y);
        }

        // Event listeners - comprehensive touch support
        canvas.addEventListener('click', handleInteraction, false);
        canvas.addEventListener('touchstart', handleInteraction, false);
        canvas.addEventListener('touchend', function(e) { e.preventDefault(); }, false);
        canvas.addEventListener('touchcancel', function(e) { e.preventDefault(); }, false);
        canvas.addEventListener('touchmove', function(e) { e.preventDefault(); }, false);

        // Prevent scrolling and bouncing on iOS
        document.body.addEventListener('touchmove', function(e) { e.preventDefault(); }, { passive: false });

        window.addEventListener('resize', resizeCanvas);

        // Initialize game
        window.addEventListener('load', function() {
            resizeCanvas();
            restartGame();
        });

        // Fallback initialization
        setTimeout(function() {
            if (canvas.width === 0) {
                resizeCanvas();
                restartGame();
            }
        }, 100);
    </script>
</body>
</html>
